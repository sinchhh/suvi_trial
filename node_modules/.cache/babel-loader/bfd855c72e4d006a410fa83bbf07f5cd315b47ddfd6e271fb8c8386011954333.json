{"ast":null,"code":"import { __assign, __read } from \"tslib\";\nimport { DOT_PATTERN, getArnResources, getSuffix, getSuffixForArnEndpoint, isBucketNameOptions, isDnsCompatibleBucketName, validateAccountId, validateArnEndpointOptions, validateDNSHostLabel, validateNoDualstack, validateNoFIPS, validateOutpostService, validatePartition, validateRegion, validateS3Service, validateService } from \"./bucketHostnameUtils\";\nexport var bucketHostname = function (options) {\n  var isCustomEndpoint = options.isCustomEndpoint,\n    baseHostname = options.baseHostname,\n    dualstackEndpoint = options.dualstackEndpoint,\n    accelerateEndpoint = options.accelerateEndpoint;\n  if (isCustomEndpoint) {\n    if (dualstackEndpoint) throw new Error(\"Dualstack endpoint is not supported with custom endpoint\");\n    if (accelerateEndpoint) throw new Error(\"Accelerate endpoint is not supported with custom endpoint\");\n  }\n  return isBucketNameOptions(options) ?\n  // Construct endpoint when bucketName is a string referring to a bucket name\n  getEndpointFromBucketName(__assign(__assign({}, options), {\n    isCustomEndpoint: isCustomEndpoint\n  })) :\n  // Construct endpoint when bucketName is an ARN referring to an S3 resource like Access Point\n  getEndpointFromArn(__assign(__assign({}, options), {\n    isCustomEndpoint: isCustomEndpoint\n  }));\n};\nvar getEndpointFromArn = function (options) {\n  var isCustomEndpoint = options.isCustomEndpoint,\n    baseHostname = options.baseHostname;\n  var _a = __read(isCustomEndpoint ? [options.clientRegion, baseHostname] :\n    // Infer client region and hostname suffix from hostname from endpoints.json, like `s3.us-west-2.amazonaws.com`\n    getSuffixForArnEndpoint(baseHostname), 2),\n    clientRegion = _a[0],\n    hostnameSuffix = _a[1];\n  var pathStyleEndpoint = options.pathStyleEndpoint,\n    _b = options.dualstackEndpoint,\n    dualstackEndpoint = _b === void 0 ? false : _b,\n    _c = options.accelerateEndpoint,\n    accelerateEndpoint = _c === void 0 ? false : _c,\n    _d = options.tlsCompatible,\n    tlsCompatible = _d === void 0 ? true : _d,\n    useArnRegion = options.useArnRegion,\n    bucketName = options.bucketName,\n    _e = options.clientPartition,\n    clientPartition = _e === void 0 ? \"aws\" : _e,\n    _f = options.clientSigningRegion,\n    clientSigningRegion = _f === void 0 ? clientRegion : _f;\n  validateArnEndpointOptions({\n    pathStyleEndpoint: pathStyleEndpoint,\n    accelerateEndpoint: accelerateEndpoint,\n    tlsCompatible: tlsCompatible\n  });\n  // Validate and parse the ARN supplied as a bucket name\n  var service = bucketName.service,\n    partition = bucketName.partition,\n    accountId = bucketName.accountId,\n    region = bucketName.region,\n    resource = bucketName.resource;\n  validateService(service);\n  validatePartition(partition, {\n    clientPartition: clientPartition\n  });\n  validateAccountId(accountId);\n  validateRegion(region, {\n    useArnRegion: useArnRegion,\n    clientRegion: clientRegion,\n    clientSigningRegion: clientSigningRegion\n  });\n  var _g = getArnResources(resource),\n    accesspointName = _g.accesspointName,\n    outpostId = _g.outpostId;\n  validateDNSHostLabel(accesspointName + \"-\" + accountId, {\n    tlsCompatible: tlsCompatible\n  });\n  var endpointRegion = useArnRegion ? region : clientRegion;\n  var signingRegion = useArnRegion ? region : clientSigningRegion;\n  if (outpostId) {\n    // if this is an Outpost ARN\n    validateOutpostService(service);\n    validateDNSHostLabel(outpostId, {\n      tlsCompatible: tlsCompatible\n    });\n    validateNoDualstack(dualstackEndpoint);\n    validateNoFIPS(endpointRegion);\n    var hostnamePrefix_1 = accesspointName + \"-\" + accountId + \".\" + outpostId;\n    return {\n      bucketEndpoint: true,\n      hostname: \"\" + hostnamePrefix_1 + (isCustomEndpoint ? \"\" : \".s3-outposts.\" + endpointRegion) + \".\" + hostnameSuffix,\n      signingRegion: signingRegion,\n      signingService: \"s3-outposts\"\n    };\n  }\n  // construct endpoint from Accesspoint ARN\n  validateS3Service(service);\n  var hostnamePrefix = accesspointName + \"-\" + accountId;\n  return {\n    bucketEndpoint: true,\n    hostname: \"\" + hostnamePrefix + (isCustomEndpoint ? \"\" : \".s3-accesspoint\" + (dualstackEndpoint ? \".dualstack\" : \"\") + \".\" + endpointRegion) + \".\" + hostnameSuffix,\n    signingRegion: signingRegion\n  };\n};\nvar getEndpointFromBucketName = function (_a) {\n  var _b = _a.accelerateEndpoint,\n    accelerateEndpoint = _b === void 0 ? false : _b,\n    region = _a.clientRegion,\n    baseHostname = _a.baseHostname,\n    bucketName = _a.bucketName,\n    _c = _a.dualstackEndpoint,\n    dualstackEndpoint = _c === void 0 ? false : _c,\n    _d = _a.pathStyleEndpoint,\n    pathStyleEndpoint = _d === void 0 ? false : _d,\n    _e = _a.tlsCompatible,\n    tlsCompatible = _e === void 0 ? true : _e,\n    _f = _a.isCustomEndpoint,\n    isCustomEndpoint = _f === void 0 ? false : _f;\n  var _g = __read(isCustomEndpoint ? [region, baseHostname] : getSuffix(baseHostname), 2),\n    clientRegion = _g[0],\n    hostnameSuffix = _g[1];\n  if (pathStyleEndpoint || !isDnsCompatibleBucketName(bucketName) || tlsCompatible && DOT_PATTERN.test(bucketName)) {\n    return {\n      bucketEndpoint: false,\n      hostname: dualstackEndpoint ? \"s3.dualstack.\" + clientRegion + \".\" + hostnameSuffix : baseHostname\n    };\n  }\n  if (accelerateEndpoint) {\n    baseHostname = \"s3-accelerate\" + (dualstackEndpoint ? \".dualstack\" : \"\") + \".\" + hostnameSuffix;\n  } else if (dualstackEndpoint) {\n    baseHostname = \"s3.dualstack.\" + clientRegion + \".\" + hostnameSuffix;\n  }\n  return {\n    bucketEndpoint: true,\n    hostname: bucketName + \".\" + baseHostname\n  };\n};","map":{"version":3,"names":["DOT_PATTERN","getArnResources","getSuffix","getSuffixForArnEndpoint","isBucketNameOptions","isDnsCompatibleBucketName","validateAccountId","validateArnEndpointOptions","validateDNSHostLabel","validateNoDualstack","validateNoFIPS","validateOutpostService","validatePartition","validateRegion","validateS3Service","validateService","bucketHostname","options","isCustomEndpoint","baseHostname","dualstackEndpoint","accelerateEndpoint","Error","getEndpointFromBucketName","__assign","getEndpointFromArn","_a","__read","clientRegion","hostnameSuffix","pathStyleEndpoint","_b","_c","_d","tlsCompatible","useArnRegion","bucketName","_e","clientPartition","_f","clientSigningRegion","service","partition","accountId","region","resource","_g","accesspointName","outpostId","endpointRegion","signingRegion","hostnamePrefix_1","bucketEndpoint","hostname","signingService","hostnamePrefix","test"],"sources":["C:\\Users\\sinch\\node_modules\\@aws-sdk\\middleware-bucket-endpoint\\src\\bucketHostname.ts"],"sourcesContent":["import {\n  ArnHostnameParams,\n  BucketHostnameParams,\n  DOT_PATTERN,\n  getArnResources,\n  getSuffix,\n  getSuffixForArnEndpoint,\n  isBucketNameOptions,\n  isDnsCompatibleBucketName,\n  validateAccountId,\n  validateArnEndpointOptions,\n  validateDNSHostLabel,\n  validateNoDualstack,\n  validateNoFIPS,\n  validateOutpostService,\n  validatePartition,\n  validateRegion,\n  validateS3Service,\n  validateService,\n} from \"./bucketHostnameUtils\";\n\nexport interface BucketHostname {\n  hostname: string;\n  bucketEndpoint: boolean;\n  signingRegion?: string;\n  signingService?: string;\n}\n\nexport const bucketHostname = (options: BucketHostnameParams | ArnHostnameParams): BucketHostname => {\n  const { isCustomEndpoint, baseHostname, dualstackEndpoint, accelerateEndpoint } = options;\n\n  if (isCustomEndpoint) {\n    if (dualstackEndpoint) throw new Error(\"Dualstack endpoint is not supported with custom endpoint\");\n    if (accelerateEndpoint) throw new Error(\"Accelerate endpoint is not supported with custom endpoint\");\n  }\n\n  return isBucketNameOptions(options)\n    ? // Construct endpoint when bucketName is a string referring to a bucket name\n      getEndpointFromBucketName({ ...options, isCustomEndpoint })\n    : // Construct endpoint when bucketName is an ARN referring to an S3 resource like Access Point\n      getEndpointFromArn({ ...options, isCustomEndpoint });\n};\n\nconst getEndpointFromArn = (options: ArnHostnameParams & { isCustomEndpoint: boolean }): BucketHostname => {\n  const { isCustomEndpoint, baseHostname } = options;\n  const [clientRegion, hostnameSuffix] = isCustomEndpoint\n    ? [options.clientRegion, baseHostname]\n    : // Infer client region and hostname suffix from hostname from endpoints.json, like `s3.us-west-2.amazonaws.com`\n      getSuffixForArnEndpoint(baseHostname);\n\n  const {\n    pathStyleEndpoint,\n    dualstackEndpoint = false,\n    accelerateEndpoint = false,\n    tlsCompatible = true,\n    useArnRegion,\n    bucketName,\n    clientPartition = \"aws\",\n    clientSigningRegion = clientRegion,\n  } = options;\n\n  validateArnEndpointOptions({ pathStyleEndpoint, accelerateEndpoint, tlsCompatible });\n\n  // Validate and parse the ARN supplied as a bucket name\n  const { service, partition, accountId, region, resource } = bucketName;\n  validateService(service);\n  validatePartition(partition, { clientPartition });\n  validateAccountId(accountId);\n  validateRegion(region, { useArnRegion, clientRegion, clientSigningRegion });\n  const { accesspointName, outpostId } = getArnResources(resource);\n  validateDNSHostLabel(`${accesspointName}-${accountId}`, { tlsCompatible });\n\n  const endpointRegion = useArnRegion ? region : clientRegion;\n  const signingRegion = useArnRegion ? region : clientSigningRegion;\n  if (outpostId) {\n    // if this is an Outpost ARN\n    validateOutpostService(service);\n    validateDNSHostLabel(outpostId, { tlsCompatible });\n    validateNoDualstack(dualstackEndpoint);\n    validateNoFIPS(endpointRegion);\n    const hostnamePrefix = `${accesspointName}-${accountId}.${outpostId}`;\n    return {\n      bucketEndpoint: true,\n      hostname: `${hostnamePrefix}${isCustomEndpoint ? \"\" : `.s3-outposts.${endpointRegion}`}.${hostnameSuffix}`,\n      signingRegion,\n      signingService: \"s3-outposts\",\n    };\n  }\n  // construct endpoint from Accesspoint ARN\n  validateS3Service(service);\n  const hostnamePrefix = `${accesspointName}-${accountId}`;\n  return {\n    bucketEndpoint: true,\n    hostname: `${hostnamePrefix}${\n      isCustomEndpoint ? \"\" : `.s3-accesspoint${dualstackEndpoint ? \".dualstack\" : \"\"}.${endpointRegion}`\n    }.${hostnameSuffix}`,\n    signingRegion,\n  };\n};\n\nconst getEndpointFromBucketName = ({\n  accelerateEndpoint = false,\n  clientRegion: region,\n  baseHostname,\n  bucketName,\n  dualstackEndpoint = false,\n  pathStyleEndpoint = false,\n  tlsCompatible = true,\n  isCustomEndpoint = false,\n}: BucketHostnameParams & { isCustomEndpoint: boolean }): BucketHostname => {\n  const [clientRegion, hostnameSuffix] = isCustomEndpoint ? [region, baseHostname] : getSuffix(baseHostname);\n  if (pathStyleEndpoint || !isDnsCompatibleBucketName(bucketName) || (tlsCompatible && DOT_PATTERN.test(bucketName))) {\n    return {\n      bucketEndpoint: false,\n      hostname: dualstackEndpoint ? `s3.dualstack.${clientRegion}.${hostnameSuffix}` : baseHostname,\n    };\n  }\n\n  if (accelerateEndpoint) {\n    baseHostname = `s3-accelerate${dualstackEndpoint ? \".dualstack\" : \"\"}.${hostnameSuffix}`;\n  } else if (dualstackEndpoint) {\n    baseHostname = `s3.dualstack.${clientRegion}.${hostnameSuffix}`;\n  }\n\n  return {\n    bucketEndpoint: true,\n    hostname: `${bucketName}.${baseHostname}`,\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
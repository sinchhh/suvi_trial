{"ast":null,"code":"import { __assign } from \"tslib\";\nimport Cookies from 'universal-cookie';\nimport { browserOrNode } from '../JS';\nvar isBrowser = browserOrNode().isBrowser;\nvar ONE_YEAR_IN_MS = 365 * 24 * 60 * 60 * 1000;\nvar UniversalStorage = /** @class */function () {\n  function UniversalStorage(context) {\n    if (context === void 0) {\n      context = {};\n    }\n    this.cookies = new Cookies();\n    this.store = isBrowser ? window.localStorage : Object.create(null);\n    this.cookies = context.req ? new Cookies(context.req.headers.cookie) : new Cookies();\n    Object.assign(this.store, this.cookies.getAll());\n  }\n  Object.defineProperty(UniversalStorage.prototype, \"length\", {\n    get: function () {\n      return Object.entries(this.store).length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  UniversalStorage.prototype.clear = function () {\n    var _this = this;\n    Array.from(new Array(this.length)).map(function (_, i) {\n      return _this.key(i);\n    }).forEach(function (key) {\n      return _this.removeItem(key);\n    });\n  };\n  UniversalStorage.prototype.getItem = function (key) {\n    return this.getLocalItem(key);\n  };\n  UniversalStorage.prototype.getLocalItem = function (key) {\n    return Object.prototype.hasOwnProperty.call(this.store, key) ? this.store[key] : null;\n  };\n  UniversalStorage.prototype.getUniversalItem = function (key) {\n    return this.cookies.get(key);\n  };\n  UniversalStorage.prototype.key = function (index) {\n    return Object.keys(this.store)[index];\n  };\n  UniversalStorage.prototype.removeItem = function (key) {\n    this.removeLocalItem(key);\n    this.removeUniversalItem(key);\n  };\n  UniversalStorage.prototype.removeLocalItem = function (key) {\n    delete this.store[key];\n  };\n  UniversalStorage.prototype.removeUniversalItem = function (key) {\n    this.cookies.remove(key, {\n      path: '/'\n    });\n  };\n  UniversalStorage.prototype.setItem = function (key, value) {\n    this.setLocalItem(key, value);\n    // keys take the shape:\n    //  1. `${ProviderPrefix}.${userPoolClientId}.${username}.${tokenType}\n    //  2. `${ProviderPrefix}.${userPoolClientId}.LastAuthUser\n    var tokenType = key.split('.').pop();\n    var sessionTokenTypes = ['LastAuthUser', 'accessToken',\n    // refreshToken originates on the client, but SSR pages won't fail when this expires\n    // Note: the new `accessToken` will also be refreshed on the client (since Amplify doesn't set server-side cookies)\n    'refreshToken',\n    // Required for CognitoUserSession\n    'idToken'];\n    if (sessionTokenTypes.includes(tokenType !== null && tokenType !== void 0 ? tokenType : '')) {\n      this.setUniversalItem(key, value, {\n        expires: new Date(Date.now() + ONE_YEAR_IN_MS)\n      });\n    }\n  };\n  UniversalStorage.prototype.setLocalItem = function (key, value) {\n    this.store[key] = value;\n  };\n  UniversalStorage.prototype.setUniversalItem = function (key, value, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    this.cookies.set(key, value, __assign(__assign({}, options), {\n      path: '/',\n      // `httpOnly` cannot be set via JavaScript: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#JavaScript_access_using_Document.cookie\n      sameSite: true,\n      // Allow unsecure requests to http://localhost:3000/ when in development.\n      secure: isBrowser && window.location.hostname === 'localhost' ? false : true\n    }));\n  };\n  return UniversalStorage;\n}();\nexport { UniversalStorage };","map":{"version":3,"names":["Cookies","browserOrNode","isBrowser","ONE_YEAR_IN_MS","UniversalStorage","context","cookies","store","window","localStorage","Object","create","req","headers","cookie","assign","getAll","defineProperty","prototype","get","entries","length","clear","_this","Array","from","map","_","i","key","forEach","removeItem","getItem","getLocalItem","hasOwnProperty","call","getUniversalItem","index","keys","removeLocalItem","removeUniversalItem","remove","path","setItem","value","setLocalItem","tokenType","split","pop","sessionTokenTypes","includes","setUniversalItem","expires","Date","now","options","set","__assign","sameSite","secure","location","hostname"],"sources":["C:\\Users\\sinch\\node_modules\\@aws-amplify\\core\\src\\UniversalStorage\\index.ts"],"sourcesContent":["import Cookies, { CookieSetOptions } from 'universal-cookie';\nimport { browserOrNode } from '../JS';\n\ntype Store = Record<string, string>;\n\nconst { isBrowser } = browserOrNode();\n\n// Avoid using @types/next because @aws-amplify/ui-angular's version of TypeScript is too old to support it\ntype Context = { req?: any };\n\nconst ONE_YEAR_IN_MS = 365 * 24 * 60 * 60 * 1000;\n\nexport class UniversalStorage implements Storage {\n\tcookies = new Cookies();\n\tstore: Store = isBrowser ? window.localStorage : Object.create(null);\n\n\tconstructor(context: Context = {}) {\n\t\tthis.cookies = context.req\n\t\t\t? new Cookies(context.req.headers.cookie)\n\t\t\t: new Cookies();\n\n\t\tObject.assign(this.store, this.cookies.getAll());\n\t}\n\n\tget length() {\n\t\treturn Object.entries(this.store).length;\n\t}\n\n\tclear() {\n\t\tArray.from(new Array(this.length))\n\t\t\t.map((_, i) => this.key(i))\n\t\t\t.forEach(key => this.removeItem(key));\n\t}\n\n\tgetItem(key: keyof Store) {\n\t\treturn this.getLocalItem(key);\n\t}\n\n\tprotected getLocalItem(key: keyof Store) {\n\t\treturn Object.prototype.hasOwnProperty.call(this.store, key)\n\t\t\t? this.store[key]\n\t\t\t: null;\n\t}\n\n\tprotected getUniversalItem(key: keyof Store) {\n\t\treturn this.cookies.get(key);\n\t}\n\n\tkey(index: number) {\n\t\treturn Object.keys(this.store)[index];\n\t}\n\n\tremoveItem(key: string) {\n\t\tthis.removeLocalItem(key);\n\t\tthis.removeUniversalItem(key);\n\t}\n\n\tprotected removeLocalItem(key: keyof Store) {\n\t\tdelete this.store[key];\n\t}\n\n\tprotected removeUniversalItem(key: keyof Store) {\n\t\tthis.cookies.remove(key, {\n\t\t\tpath: '/',\n\t\t});\n\t}\n\n\tsetItem(key: keyof Store, value: string) {\n\t\tthis.setLocalItem(key, value);\n\n\t\t// keys take the shape:\n\t\t//  1. `${ProviderPrefix}.${userPoolClientId}.${username}.${tokenType}\n\t\t//  2. `${ProviderPrefix}.${userPoolClientId}.LastAuthUser\n\t\tconst tokenType = key.split('.').pop();\n\n\t\tconst sessionTokenTypes = [\n\t\t\t'LastAuthUser',\n\t\t\t'accessToken',\n\t\t\t// refreshToken originates on the client, but SSR pages won't fail when this expires\n\t\t\t// Note: the new `accessToken` will also be refreshed on the client (since Amplify doesn't set server-side cookies)\n\t\t\t'refreshToken',\n\t\t\t// Required for CognitoUserSession\n\t\t\t'idToken',\n\t\t\t// userData is used when `Auth.currentAuthenticatedUser({ bypassCache: false })`.\n\t\t\t// Can be persisted to speed up calls to `Auth.currentAuthenticatedUser()`\n\t\t\t// 'userData',\n\n\t\t\t// Ignoring clockDrift on the server for now, but needs testing\n\t\t\t// 'clockDrift',\n\t\t];\n\t\tif (sessionTokenTypes.includes(tokenType ?? '')) {\n\t\t\tthis.setUniversalItem(key, value, {\n\t\t\t\texpires: new Date(Date.now() + ONE_YEAR_IN_MS),\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected setLocalItem(key: keyof Store, value: string) {\n\t\tthis.store[key] = value;\n\t}\n\n\tprotected setUniversalItem(\n\t\tkey: keyof Store,\n\t\tvalue: string,\n\t\toptions: CookieSetOptions = {}\n\t) {\n\t\tthis.cookies.set(key, value, {\n\t\t\t...options,\n\t\t\tpath: '/',\n\t\t\t// `httpOnly` cannot be set via JavaScript: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#JavaScript_access_using_Document.cookie\n\t\t\tsameSite: true,\n\t\t\t// Allow unsecure requests to http://localhost:3000/ when in development.\n\t\t\tsecure:\n\t\t\t\tisBrowser && window.location.hostname === 'localhost' ? false : true,\n\t\t});\n\t}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
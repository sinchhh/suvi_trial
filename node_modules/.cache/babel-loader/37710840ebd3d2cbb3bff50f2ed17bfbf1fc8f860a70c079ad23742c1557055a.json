{"ast":null,"code":"import { __assign, __awaiter, __generator, __values } from \"tslib\";\nimport { isArrayBuffer } from \"@aws-sdk/is-array-buffer\";\nimport { HttpRequest } from \"@aws-sdk/protocol-http\";\nexport function applyMd5BodyChecksumMiddleware(options) {\n  var _this = this;\n  return function (next) {\n    return function (args) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var request, body, headers, digest, hash, _a, _b, _c, _d, _e;\n        var _f, _g;\n        return __generator(this, function (_h) {\n          switch (_h.label) {\n            case 0:\n              request = args.request;\n              if (!HttpRequest.isInstance(request)) return [3 /*break*/, 2];\n              body = request.body, headers = request.headers;\n              if (!!hasHeader(\"Content-MD5\", headers)) return [3 /*break*/, 2];\n              digest = void 0;\n              if (body === undefined || typeof body === \"string\" || ArrayBuffer.isView(body) || isArrayBuffer(body)) {\n                hash = new options.md5();\n                hash.update(body || \"\");\n                digest = hash.digest();\n              } else {\n                digest = options.streamHasher(options.md5, body);\n              }\n              _a = [__assign({}, request)];\n              _f = {};\n              _b = [__assign({}, headers)];\n              _g = {};\n              _c = \"Content-MD5\";\n              _e = (_d = options).base64Encoder;\n              return [4 /*yield*/, digest];\n            case 1:\n              request = __assign.apply(void 0, _a.concat([(_f.headers = __assign.apply(void 0, _b.concat([(_g[_c] = _e.apply(_d, [_h.sent()]), _g)])), _f)]));\n              _h.label = 2;\n            case 2:\n              return [2 /*return*/, next(__assign(__assign({}, args), {\n                request: request\n              }))];\n          }\n        });\n      });\n    };\n  };\n}\nexport var applyMd5BodyChecksumMiddlewareOptions = {\n  name: \"applyMd5BodyChecksumMiddleware\",\n  step: \"build\",\n  tags: [\"SET_CONTENT_MD5\", \"BODY_CHECKSUM\"],\n  override: true\n};\nexport var getApplyMd5BodyChecksumPlugin = function (config) {\n  return {\n    applyToStack: function (clientStack) {\n      clientStack.add(applyMd5BodyChecksumMiddleware(config), applyMd5BodyChecksumMiddlewareOptions);\n    }\n  };\n};\nfunction hasHeader(soughtHeader, headers) {\n  var e_1, _a;\n  soughtHeader = soughtHeader.toLowerCase();\n  try {\n    for (var _b = __values(Object.keys(headers)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var headerName = _c.value;\n      if (soughtHeader === headerName.toLowerCase()) {\n        return true;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n  return false;\n}","map":{"version":3,"names":["isArrayBuffer","HttpRequest","applyMd5BodyChecksumMiddleware","options","_this","next","args","__awaiter","request","isInstance","body","headers","hasHeader","digest","undefined","ArrayBuffer","isView","hash","md5","update","streamHasher","_c","_e","_d","base64Encoder","__assign","apply","_a","concat","_f","_b","_g","_h","sent","applyMd5BodyChecksumMiddlewareOptions","name","step","tags","override","getApplyMd5BodyChecksumPlugin","config","applyToStack","clientStack","add","soughtHeader","toLowerCase","__values","Object","keys","done","headerName","value"],"sources":["C:\\Users\\sinch\\node_modules\\@aws-sdk\\middleware-apply-body-checksum\\src\\applyMd5BodyChecksumMiddleware.ts"],"sourcesContent":["import { isArrayBuffer } from \"@aws-sdk/is-array-buffer\";\nimport { HttpRequest } from \"@aws-sdk/protocol-http\";\nimport {\n  BuildHandler,\n  BuildHandlerArguments,\n  BuildHandlerOptions,\n  BuildHandlerOutput,\n  BuildMiddleware,\n  HeaderBag,\n  MetadataBearer,\n  Pluggable,\n} from \"@aws-sdk/types\";\n\nimport { Md5BodyChecksumResolvedConfig } from \"./md5Configuration\";\n\nexport function applyMd5BodyChecksumMiddleware(options: Md5BodyChecksumResolvedConfig): BuildMiddleware<any, any> {\n  return <Output extends MetadataBearer>(next: BuildHandler<any, Output>): BuildHandler<any, Output> => async (\n    args: BuildHandlerArguments<any>\n  ): Promise<BuildHandlerOutput<Output>> => {\n    let { request } = args;\n    if (HttpRequest.isInstance(request)) {\n      const { body, headers } = request;\n      if (!hasHeader(\"Content-MD5\", headers)) {\n        let digest: Promise<Uint8Array>;\n        if (body === undefined || typeof body === \"string\" || ArrayBuffer.isView(body) || isArrayBuffer(body)) {\n          const hash = new options.md5();\n          hash.update(body || \"\");\n          digest = hash.digest();\n        } else {\n          digest = options.streamHasher(options.md5, body);\n        }\n\n        request = {\n          ...request,\n          headers: {\n            ...headers,\n            \"Content-MD5\": options.base64Encoder(await digest),\n          },\n        };\n      }\n    }\n    return next({\n      ...args,\n      request,\n    });\n  };\n}\n\nexport const applyMd5BodyChecksumMiddlewareOptions: BuildHandlerOptions = {\n  name: \"applyMd5BodyChecksumMiddleware\",\n  step: \"build\",\n  tags: [\"SET_CONTENT_MD5\", \"BODY_CHECKSUM\"],\n  override: true,\n};\n\nexport const getApplyMd5BodyChecksumPlugin = (config: Md5BodyChecksumResolvedConfig): Pluggable<any, any> => ({\n  applyToStack: (clientStack) => {\n    clientStack.add(applyMd5BodyChecksumMiddleware(config), applyMd5BodyChecksumMiddlewareOptions);\n  },\n});\n\nfunction hasHeader(soughtHeader: string, headers: HeaderBag): boolean {\n  soughtHeader = soughtHeader.toLowerCase();\n  for (const headerName of Object.keys(headers)) {\n    if (soughtHeader === headerName.toLowerCase()) {\n      return true;\n    }\n  }\n\n  return false;\n}\n"],"mappings":";AAAA,SAASA,aAAa,QAAQ,0BAA0B;AACxD,SAASC,WAAW,QAAQ,wBAAwB;AAcpD,OAAM,SAAUC,8BAA8BA,CAACC,OAAsC;EAArF,IAAAC,KAAA;EACE,OAAO,UAAgCC,IAA+B;IAAgC,iBACpGC,IAAgC;MAAA,OAAAC,SAAA,CAAAH,KAAA;;;;;;cAE1BI,OAAO,GAAKF,IAAI,CAAAE,OAAT;mBACTP,WAAW,CAACQ,UAAU,CAACD,OAAO,CAAC,EAA/B;cACME,IAAI,GAAcF,OAAO,CAAAE,IAArB,EAAEC,OAAO,GAAKH,OAAO,CAAAG,OAAZ;mBACjB,CAACC,SAAS,CAAC,aAAa,EAAED,OAAO,CAAC,EAAlC;cACEE,MAAM,SAAqB;cAC/B,IAAIH,IAAI,KAAKI,SAAS,IAAI,OAAOJ,IAAI,KAAK,QAAQ,IAAIK,WAAW,CAACC,MAAM,CAACN,IAAI,CAAC,IAAIV,aAAa,CAACU,IAAI,CAAC,EAAE;gBAC/FO,IAAI,GAAG,IAAId,OAAO,CAACe,GAAG,EAAE;gBAC9BD,IAAI,CAACE,MAAM,CAACT,IAAI,IAAI,EAAE,CAAC;gBACvBG,MAAM,GAAGI,IAAI,CAACJ,MAAM,EAAE;eACvB,MAAM;gBACLA,MAAM,GAAGV,OAAO,CAACiB,YAAY,CAACjB,OAAO,CAACe,GAAG,EAAER,IAAI,CAAC;;iCAI7CF,OAAO;;iCAELG,OAAO;;cACVU,EAAA,gBAAa;cAAEC,EAAA,IAAAC,EAAA,GAAApB,OAAO,EAACqB,aAAa;cAAC,qBAAMX,MAAM;;cAJrDL,OAAO,GAAAiB,QAAA,CAAAC,KAAA,SAAAC,EAAA,CAAAC,MAAA,GAELC,EAAA,CAAAlB,OAAO,GAAAc,QAAA,CAAAC,KAAA,SAAAI,EAAA,CAAAF,MAAA,GAELG,EAAA,CAAAV,EAAA,CAAa,GAAEC,EAAA,CAAAI,KAAA,CAAAH,EAAA,GAAsBS,EAAA,CAAAC,IAAA,EAAY,EAAC,EAAAF,EAAA,MAAAF,EAAA,IAErD;;;cAGL,sBAAOxB,IAAI,CAAAoB,QAAA,CAAAA,QAAA,KACNnB,IAAI;gBACPE,OAAO,EAAAA;cAAA,GACP;;;;KACH;EA7BqG,CA6BrG;AACH;AAEA,OAAO,IAAM0B,qCAAqC,GAAwB;EACxEC,IAAI,EAAE,gCAAgC;EACtCC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,CAAC,iBAAiB,EAAE,eAAe,CAAC;EAC1CC,QAAQ,EAAE;CACX;AAED,OAAO,IAAMC,6BAA6B,GAAG,SAAAA,CAACC,MAAqC;EAA0B,OAAC;IAC5GC,YAAY,EAAE,SAAAA,CAACC,WAAW;MACxBA,WAAW,CAACC,GAAG,CAACzC,8BAA8B,CAACsC,MAAM,CAAC,EAAEN,qCAAqC,CAAC;IAChG;GACD;AAJ4G,CAI3G;AAEF,SAAStB,SAASA,CAACgC,YAAoB,EAAEjC,OAAkB;;EACzDiC,YAAY,GAAGA,YAAY,CAACC,WAAW,EAAE;;IACzC,KAAyB,IAAAf,EAAA,GAAAgB,QAAA,CAAAC,MAAM,CAACC,IAAI,CAACrC,OAAO,CAAC,GAAAU,EAAA,GAAAS,EAAA,CAAAzB,IAAA,KAAAgB,EAAA,CAAA4B,IAAA,EAAA5B,EAAA,GAAAS,EAAA,CAAAzB,IAAA,IAAE;MAA1C,IAAM6C,UAAU,GAAA7B,EAAA,CAAA8B,KAAA;MACnB,IAAIP,YAAY,KAAKM,UAAU,CAACL,WAAW,EAAE,EAAE;QAC7C,OAAO,IAAI;;;;;;;;;;;;;;EAIf,OAAO,KAAK;AACd"},"metadata":{},"sourceType":"module","externalDependencies":[]}